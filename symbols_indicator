import yfinance as yf
import pandas as pd
from concurrent.futures import ThreadPoolExecutor, as_completed
import time

tickers = symbols

fields = [
    "longName", "sector", "marketCap",
    "trailingPE", "priceToBook", "dividendYield",
    "returnOnEquity", "regularMarketPrice"
    #수정할 부분 
]

def fetch_info(ticker):
    try:
        info = yf.Ticker(ticker).info
        row = {"Ticker": ticker}
        for f in fields:
            row[f] = info.get(f, None)
        return row
    except Exception:
        return {"Ticker": ticker, "Error": "Fetch failed"}

# ✅ 병렬 수집 (최대 10개씩 동시에)
results = []
with ThreadPoolExecutor(max_workers=10) as executor:
    futures = [executor.submit(fetch_info, t) for t in tickers]
    for i, f in enumerate(as_completed(futures), 1):
        results.append(f.result())
        if i % 50 == 0:
            print(f"{i}/503 complete...")
        time.sleep(0.1)

df = pd.DataFrame(results)
df.to_csv("S&P 500.csv", index=False)
print("완료 — S&P 500.csv 저장됨")
